{% extends 'layout.html' %}
{% block content %}
<!-- Section des réservations moderne -->
<section class="reservations-section py-5">
    <div class="container">
        <!-- En-tête de la page -->
        <div class="page-header text-center mb-5">
            <h2 class="section-title">
                <i class="fas fa-calendar-check me-2"></i>
                Réservations des courts
            </h2>
            <p class="lead text-muted">Réservez votre créneau de tennis en quelques clics</p>
        </div>

        <!-- Statistiques utilisateur -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="stats-cards">
                    <div class="row">
                        <div class="col-md-4 col-6 mb-3">
                            <div class="stat-card text-center">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-alt fa-2x text-primary"></i>
                                </div>
                                <div class="stat-number">{{ user_stats.total_reservations }}</div>
                                <div class="stat-label">Réservations totales</div>
                            </div>
                        </div>
                        <div class="col-md-4 col-6 mb-3">
                            <div class="stat-card text-center">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-day fa-2x text-success"></i>
                                </div>
                                <div class="stat-number">{{ user_stats.days_played }}</div>
                                <div class="stat-label">Jours joués</div>
                            </div>
                        </div>
                        <div class="col-md-4 col-6 mb-3">
                            <div class="stat-card text-center">
                                <div class="stat-icon">
                                    <i class="fas fa-tennis-ball fa-2x text-warning"></i>
                                </div>
                                <div class="stat-number">{{ user_reservations|length }}</div>
                                <div class="stat-label">Réservations actives</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation des vues -->
        <div class="view-navigation mb-4">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="btn-group w-100" role="group">
                        <button type="button" class="btn btn-outline-primary {% if view_type == 'day' %}active{% endif %}" data-view="day">
                            <i class="fas fa-calendar-day me-2"></i>Jour
                        </button>
                        <button type="button" class="btn btn-outline-primary {% if view_type == 'week' %}active{% endif %}" data-view="week">
                            <i class="fas fa-calendar-week me-2"></i>Semaine
                        </button>
                        <button type="button" class="btn btn-outline-primary {% if view_type == 'month' %}active{% endif %}" data-view="month">
                            <i class="fas fa-calendar-alt me-2"></i>Mois
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sélecteur de date amélioré -->
        <div class="date-selector-wrapper mb-5">
            <form method="get" class="date-selector-form">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="input-group input-group-lg">
                            <button type="button" class="btn btn-outline-secondary" onclick="changeDate(-1)">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <input type="date" 
                                   class="form-control text-center" 
                                   name="date" 
                                   id="dateSelector"
                                   value="{{ selected_date }}" 
                                   onchange="this.form.submit()"
                                   min="{{ today_date }}">
                            <button type="button" class="btn btn-outline-secondary" onclick="changeDate(1)">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div class="text-center mt-2">
                            <small class="text-muted">Utilisez les flèches pour naviguer entre les dates</small>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="row">
                    <!-- Planning principal -->
        <div class="col-lg-8 mb-4">
            <!-- Actions rapides -->
            <div class="quick-actions mb-4">
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <button class="btn btn-outline-success w-100" data-bs-toggle="modal" data-bs-target="#recurringModal">
                            <i class="fas fa-redo me-2"></i>Réservation récurrente
                        </button>
                    </div>
                    <div class="col-md-6 mb-2">
                        <button class="btn btn-outline-info w-100" data-bs-toggle="modal" data-bs-target="#favoritesModal">
                            <i class="fas fa-heart me-2"></i>Créneaux favoris
                        </button>
                    </div>
                </div>
            </div>
            <div class="schedule-card">
                <div class="schedule-header">
                    <h3 class="schedule-title">
                        {% if view_type == "week" %}
                            <i class="fas fa-calendar-week me-2"></i>
                            Planning de la semaine du {{ week_start }} au {{ week_end }}
                        {% else %}
                            <i class="fas fa-calendar-day me-2"></i>
                            Planning du {{ selected_date }}
                        {% endif %}
                    </h3>
                                         <div class="schedule-legend">
                         {% if view_type == "week" %}
                             <!-- Légende pour la vue semaine -->
                             <div class="legend-courts">
                                 <span class="legend-title">Courts :</span>
                                 <span class="legend-item">
                                     <span class="legend-color court-1-available"></span>
                                     Court 1
                                 </span>
                                 <span class="legend-item">
                                     <span class="legend-color court-2-available"></span>
                                     Court 2
                                 </span>
                                 <span class="legend-item">
                                     <span class="legend-color court-3-available"></span>
                                     Court 3
                                 </span>
                             </div>
                             <div class="legend-status">
                                 <span class="legend-title">Statut :</span>
                                 <span class="legend-item">
                                     <span class="legend-color available"></span>
                                     Libre
                                 </span>
                                 <span class="legend-item">
                                     <span class="legend-color reserved"></span>
                                     Réservé
                                 </span>
                             </div>
                         {% else %}
                             <!-- Légende pour la vue jour -->
                             <span class="legend-item">
                                 <span class="legend-color available"></span>
                                 Libre
                             </span>
                             <span class="legend-item">
                                 <span class="legend-color reserved"></span>
                                 Réservé
                             </span>
                         {% endif %}
                     </div>
                </div>
                    
                    <!-- Version desktop -->
                    <div class="table-responsive d-none d-lg-block">
                        {% if view_type == "week" %}
                            <!-- Vue semaine -->
                            <table class="table schedule-table week-view">
                                <thead>
                                    <tr>
                                        <th class="time-header">Heure</th>
                                        {% for week_date in week_dates %}
                                            <th class="day-header">
                                                <div class="day-info">
                                                    <div class="day-name">{{ week_date.day_name|title }}</div>
                                                    <div class="day-date">{{ week_date.day_number }}</div>
                                                </div>
                                            </th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                {% for slot in time_slots %}
                                    <tr class="time-row">
                                        <th scope="row" class="time-slot">
                                            <div class="time-display">
                                                <span class="time-start">{{ slot[0] }}</span>
                                                <span class="time-separator">–</span>
                                                <span class="time-end">{{ slot[1] }}</span>
                                            </div>
                                        </th>
                                                                                 {% for week_date in week_dates %}
                                             <td class="day-cell">
                                                 <div class="day-slot-info">
                                                     {% set date_str = week_date.date %}
                                                     {% if week_availability and date_str in week_availability %}
                                                         <div class="courts-status">
                                                             {% for court in (1, 2, 3) %}
                                                                 {% if court in week_availability[date_str] %}
                                                                     {% set slot_info = week_availability[date_str][court][slot] %}
                                                                     {% set is_reserved = slot_info.reserved %}
                                                                     <div class="court-indicator court-{{ court }} {% if is_reserved %}reserved{% else %}available{% endif %}" 
                                                                          title="Court {{ court }}: {% if is_reserved %}Réservé{% else %}Libre{% endif %}">
                                                                         <span class="court-number">{{ court }}</span>
                                                                     </div>
                                                                 {% endif %}
                                                             {% endfor %}
                                                         </div>
                                                     {% else %}
                                                         <small class="text-muted">-</small>
                                                     {% endif %}
                                                 </div>
                                             </td>
                                         {% endfor %}
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <!-- Vue jour (existant) -->
                            <table class="table schedule-table">
                                <thead>
                                    <tr>
                                        <th class="time-header">Heure</th>
                                        <th class="court-header">Court 1</th>
                                        <th class="court-header">Court 2</th>
                                        <th class="court-header">Court 3</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for slot in time_slots %}
                                    <tr class="time-row">
                                        <th scope="row" class="time-slot">
                                            <div class="time-display">
                                                <span class="time-start">{{ slot[0] }}</span>
                                                <span class="time-separator">–</span>
                                                <span class="time-end">{{ slot[1] }}</span>
                                            </div>
                                        </th>
                                        {% for court in (1, 2, 3) %}
                                            {% set slot_info = availability[court][slot] %}
                                            {% set is_reserved = slot_info.reserved %}
                                            <td class="court-cell">
                                                {% if is_reserved %}
                                                    {% set reservation_info = slot_info.reservation_info %}
                                                    <div class="slot-reserved {% if reservation_info.is_current_user %}slot-own-reservation{% endif %}">
                                                        <i class="fas fa-lock me-2"></i>
                                                        <div class="reservation-details">
                                                            <span class="reserved-by">
                                                                {% if reservation_info.is_current_user %}
                                                                    <strong>Vous</strong>
                                                                {% else %}
                                                                    {{ reservation_info.user_full_name }}
                                                                {% endif %}
                                                            </span>
                                                            <small class="username-display">@{{ reservation_info.username }}</small>
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <button type="button" 
                                                            class="btn slot-available" 
                                                            data-court="{{ court }}" 
                                                            data-start="{{ slot[0] }}" 
                                                            data-end="{{ slot[1] }}"
                                                            data-bs-toggle="modal" 
                                                            data-bs-target="#reservationModal">
                                                        <i class="fas fa-check me-2"></i>
                                                        <span>Libre</span>
                                                    </button>
                                                {% endif %}
                                            </td>
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% endif %}
                    </div>
                    
                    <!-- Version mobile -->
                    <div class="d-lg-none">
                        <div class="mobile-schedule">
                            {% for slot in time_slots %}
                                <div class="mobile-time-slot">
                                    <div class="mobile-time-header">
                                        <i class="fas fa-clock me-2"></i>
                                        <strong>{{ slot[0] }} - {{ slot[1] }}</strong>
                                    </div>
                                    <div class="mobile-courts">
                                        {% for court in (1, 2, 3) %}
                                            {% set slot_info = availability[court][slot] %}
                                            {% set is_reserved = slot_info.reserved %}
                                            <div class="mobile-court-item">
                                                <div class="court-label">
                                                    <i class="fas fa-tennis-ball me-1"></i>
                                                    Court {{ court }}
                                                </div>
                                                {% if is_reserved %}
                                                    {% set reservation_info = slot_info.reservation_info %}
                                                    <div class="mobile-slot-reserved {% if reservation_info.is_current_user %}mobile-own-reservation{% endif %}">
                                                        <i class="fas fa-lock me-2"></i>
                                                        <div class="mobile-reservation-details">
                                                            <span class="reserved-by">
                                                                {% if reservation_info.is_current_user %}
                                                                    <strong>Vous</strong>
                                                                {% else %}
                                                                    {{ reservation_info.user_full_name }}
                                                                {% endif %}
                                                            </span>
                                                            <small class="username-display">@{{ reservation_info.username }}</small>
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <button type="button" 
                                                            class="btn btn-primary btn-sm mobile-slot-available" 
                                                            data-court="{{ court }}" 
                                                            data-start="{{ slot[0] }}" 
                                                            data-end="{{ slot[1] }}"
                                                            data-bs-toggle="modal" 
                                                            data-bs-target="#reservationModal">
                                                        <i class="fas fa-plus me-1"></i>
                                                        Réserver
                                                    </button>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="schedule-footer">
                        <p class="text-muted">
                            <i class="fas fa-info-circle me-2"></i>
                            Cliquez sur un créneau libre pour créer une réservation d'une heure.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Mes réservations -->
            <div class="col-lg-4">
                <!-- Version desktop -->
                <div class="my-reservations-card d-none d-lg-block">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-list me-2"></i>
                            Mes réservations
                        </h3>
                    </div>
                    
                    <div class="card-body">
                        {% if user_reservations %}
                            <div class="reservations-list">
                                {% for r in user_reservations %}
                                    <div class="reservation-item">
                                        <div class="reservation-header">
                                            <span class="reservation-date">
                                                <i class="fas fa-calendar me-1"></i>
                                                {{ r.date }}
                                            </span>
                                            <span class="reservation-court">
                                                <i class="fas fa-tennis-ball me-1"></i>
                                                Court {{ r.court_number }}
                                            </span>
                                        </div>
                                        <div class="reservation-time">
                                            <i class="fas fa-clock me-1"></i>
                                            {{ r.start_time }} - {{ r.end_time }}
                                        </div>
                                        <div class="reservation-actions">
                                            <a href="/reservations/{{ r.id }}/export-ics" 
                                               class="btn btn-sm btn-outline-primary me-1"
                                               title="Exporter vers le calendrier">
                                                <i class="fas fa-calendar-plus"></i>
                                            </a>
                                            <button class="btn btn-sm btn-outline-danger" 
                                                    onclick="cancelReservation({{ r.id }})"
                                                    title="Annuler la réservation">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-reservations">
                                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">Aucune réservation</h5>
                                <p class="text-muted">Vous n'avez pas encore de réservation.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Version mobile -->
                <div class="d-lg-none">
                    <div class="mobile-user-reservations">
                        <h4 class="mb-3">
                            <i class="fas fa-calendar-check me-2"></i>
                            Mes réservations
                        </h4>
                        {% if user_reservations %}
                            <div class="mobile-reservations-list">
                                {% for r in user_reservations %}
                                    <div class="mobile-reservation-item">
                                        <div class="mobile-reservation-info">
                                            <div class="mobile-reservation-time">
                                                <i class="fas fa-clock me-1"></i>
                                                {{ r.start_time }} - {{ r.end_time }}
                                            </div>
                                            <div class="mobile-reservation-court">
                                                <i class="fas fa-tennis-ball me-1"></i>
                                                Court {{ r.court_number }} • {{ r.date }}
                                            </div>
                                        </div>
                                        <div class="mobile-reservation-actions">
                                            <a href="/reservations/{{ r.id }}/export-ics" 
                                               class="btn btn-sm btn-outline-primary"
                                               title="Exporter vers le calendrier">
                                                <i class="fas fa-calendar-plus"></i>
                                            </a>
                                            <button class="btn btn-sm btn-outline-danger" 
                                                    onclick="cancelReservation({{ r.id }})"
                                                    title="Annuler la réservation">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">Aucune réservation</h5>
                                <p class="text-muted">Vous n'avez pas encore de réservation.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal de confirmation de réservation -->
<div class="modal fade" id="reservationModal" tabindex="-1" aria-labelledby="reservationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reservationModalLabel">
                    <i class="fas fa-calendar-check me-2"></i>
                    Confirmer la réservation
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="reservation-details">
                    <div class="detail-item">
                        <i class="fas fa-calendar me-2"></i>
                        <strong>Date :</strong> <span id="modal-date">{{ selected_date }}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-tennis-ball me-2"></i>
                        <strong>Court :</strong> <span id="modal-court"></span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-clock me-2"></i>
                        <strong>Horaire :</strong> <span id="modal-time"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Annuler
                </button>
                <form id="reservationForm" method="post" style="display: inline;">
                    <input type="hidden" name="date" value="{{ selected_date }}">
                    <input type="hidden" name="court_number" id="form_court_number">
                    <input type="hidden" name="start_time" id="form_start_time">
                    <input type="hidden" name="end_time" id="form_end_time">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check me-2"></i>Confirmer
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Gestion des clics sur les créneaux libres
    const slots = document.querySelectorAll('.slot-available');
    slots.forEach(function (btn) {
        btn.addEventListener('click', function () {
            const court = this.getAttribute('data-court');
            const start = this.getAttribute('data-start');
            const end = this.getAttribute('data-end');
            
            // Mise à jour du modal
            document.getElementById('modal-court').textContent = 'Court ' + court;
            document.getElementById('modal-time').textContent = start + ' - ' + end;
            
            // Mise à jour du formulaire caché
            document.getElementById('form_court_number').value = court;
            document.getElementById('form_start_time').value = start;
            document.getElementById('form_end_time').value = end;
        });
    });
});

function cancelReservation(reservationId) {
    if (confirm('Êtes-vous sûr de vouloir annuler cette réservation ?')) {
        // Ici vous pouvez ajouter la logique pour annuler la réservation
        // Par exemple, faire une requête AJAX vers une route de suppression
        console.log('Annulation de la réservation:', reservationId);
    }
}

// Animation des créneaux au survol
document.querySelectorAll('.slot-available').forEach(slot => {
    slot.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.05)';
    });
    
    slot.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
    });
    });

    // Fonction pour changer la date
    function changeDate(days) {
        const dateInput = document.getElementById('dateSelector');
        const currentDate = new Date(dateInput.value);
        currentDate.setDate(currentDate.getDate() + days);
        
        // Formater la date au format YYYY-MM-DD
        const year = currentDate.getFullYear();
        const month = String(currentDate.getMonth() + 1).padStart(2, '0');
        const day = String(currentDate.getDate()).padStart(2, '0');
        const newDate = `${year}-${month}-${day}`;
        
        dateInput.value = newDate;
        dateInput.form.submit();
    }

    // Gestion des vues (jour/semaine/mois)
    document.querySelectorAll('[data-view]').forEach(button => {
        button.addEventListener('click', function() {
            // Retirer la classe active de tous les boutons
            document.querySelectorAll('[data-view]').forEach(btn => btn.classList.remove('active'));
            // Ajouter la classe active au bouton cliqué
            this.classList.add('active');
            
            // Changer la vue en mettant à jour l'URL
            const view = this.dataset.view;
            const currentUrl = new URL(window.location);
            currentUrl.searchParams.set('view', view);
            
            // Si on passe en vue semaine, on peut ajuster la date pour être au début de la semaine
            if (view === 'week') {
                const currentDate = new Date(currentUrl.searchParams.get('date') || new Date());
                const daysSinceMonday = currentDate.getDay() === 0 ? 6 : currentDate.getDay() - 1;
                const monday = new Date(currentDate);
                monday.setDate(currentDate.getDate() - daysSinceMonday);
                currentUrl.searchParams.set('date', monday.toISOString().split('T')[0]);
            }
            
            // Rediriger vers la nouvelle URL
            window.location.href = currentUrl.toString();
        });
    });

    // Initialisation des dates dans le modal récurrent
    const recurringModal = document.getElementById('recurringModal');
    if (recurringModal) {
        recurringModal.addEventListener('show.bs.modal', function() {
            const today = new Date();
            const startDate = today.toISOString().split('T')[0];
            
            // Date de fin = 1 mois plus tard
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + 1);
            const endDateStr = endDate.toISOString().split('T')[0];
            
            const startDateInput = document.querySelector('input[name="start_date"]');
            const endDateInput = document.querySelector('input[name="end_date"]');
            
            if (startDateInput) startDateInput.value = startDate;
            if (endDateInput) endDateInput.value = endDateStr;
        });
    }

    // Fonction pour créer une réservation récurrente
    function createRecurringReservation() {
        const form = document.getElementById('recurringForm');
        const formData = new FormData(form);
        
        fetch('/reservations/recurring', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Réservation récurrente créée avec succès !');
                bootstrap.Modal.getInstance(document.getElementById('recurringModal')).hide();
                form.reset();
                // Recharger la page pour afficher les nouvelles réservations
                location.reload();
            } else {
                alert('Erreur lors de la création : ' + data.message);
            }
        })
        .catch(error => {
            console.error('Erreur:', error);
            alert('Erreur lors de la création de la réservation récurrente');
        });
    }

    // Fonction pour charger les créneaux favoris
    function loadFavorites() {
        fetch('/reservations/favorites')
            .then(response => response.json())
            .then(data => {
                const favoritesList = document.getElementById('favoritesList');
                if (data.favorites && data.favorites.length > 0) {
                    let html = '<div class="list-group">';
                    data.favorites.forEach(fav => {
                        html += `
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>Court ${fav.court_number}</strong><br>
                                    <small class="text-muted">${fav.start_time} - ${fav.end_time}</small>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" onclick="applyFavorite(${fav.court_number}, '${fav.start_time}', '${fav.end_time}')">
                                    <i class="fas fa-check me-1"></i>Appliquer
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                    favoritesList.innerHTML = html;
                } else {
                    favoritesList.innerHTML = '<p class="text-muted text-center">Aucun créneau favori enregistré</p>';
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                document.getElementById('favoritesList').innerHTML = '<p class="text-danger text-center">Erreur lors du chargement</p>';
            });
    }

    // Fonction pour appliquer un créneau favori
    function applyFavorite(court, startTime, endTime) {
        // Remplir le formulaire de réservation avec les valeurs du favori
        document.querySelector('input[name="court_number"]').value = court;
        document.querySelector('input[name="start_time"]').value = startTime;
        document.querySelector('input[name="end_time"]').value = endTime;
        
        // Fermer le modal des favoris
        bootstrap.Modal.getInstance(document.getElementById('favoritesModal')).hide();
        
        // Faire défiler vers le formulaire de réservation (sans effet de défilement)
        const reservationForm = document.querySelector('.reservation-form');
        if (reservationForm) {
            reservationForm.scrollIntoView();
        }
    }

    // Charger les favoris quand le modal s'ouvre
    const favoritesModal = document.getElementById('favoritesModal');
    if (favoritesModal) {
        favoritesModal.addEventListener('show.bs.modal', loadFavorites);
    }
    </script>

    <!-- Modal Réservation récurrente -->
    <div class="modal fade" id="recurringModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-redo me-2"></i>Réservation récurrente
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="recurringForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Court</label>
                                <select class="form-select" name="court_number" required>
                                    <option value="1">Court 1</option>
                                    <option value="2">Court 2</option>
                                    <option value="3">Court 3</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Fréquence</label>
                                <select class="form-select" name="frequency" required>
                                    <option value="weekly">Hebdomadaire</option>
                                    <option value="biweekly">Bi-hebdomadaire</option>
                                    <option value="monthly">Mensuelle</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Heure de début</label>
                                <input type="time" class="form-control" name="start_time" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Heure de fin</label>
                                <input type="time" class="form-control" name="end_time" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date de début</label>
                                <input type="date" class="form-control" name="start_date" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date de fin</label>
                                <input type="date" class="form-control" name="end_date" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-success" onclick="createRecurringReservation()">
                        <i class="fas fa-save me-2"></i>Créer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Créneaux favoris -->
    <div class="modal fade" id="favoritesModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-heart me-2"></i>Mes créneaux favoris
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="favoritesList">
                        <p class="text-muted text-center">Chargement des créneaux favoris...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>

        <style>
    /* Styles pour la navigation des vues */
    .view-navigation .btn-group .btn {
        border-radius: 0;
    }
    
    .view-navigation .btn-group .btn:first-child {
        border-top-left-radius: 0.375rem;
        border-bottom-left-radius: 0.375rem;
    }
    
    .view-navigation .btn-group .btn:last-child {
        border-top-right-radius: 0.375rem;
        border-bottom-right-radius: 0.375rem;
    }
    
    .view-navigation .btn.active {
        background-color: #0d6efd;
        border-color: #0d6efd;
        color: white;
    }
    
    /* Styles pour les actions rapides */
    .quick-actions .btn {
        transition: all 0.3s ease;
    }
    
    .quick-actions .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* Styles pour la vue semaine */
    .week-view .day-header {
        text-align: center;
        vertical-align: middle;
        min-width: 120px;
    }
    
    .week-view .day-info {
        padding: 8px;
    }
    
    .week-view .day-name {
        font-size: 0.8rem;
        font-weight: 600;
        color: #6c7280;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .week-view .day-date {
        font-size: 1.2rem;
        font-weight: 700;
        color: #1f2937;
        margin-top: 4px;
    }
    
    .week-view .day-cell {
        text-align: center;
        vertical-align: middle;
        min-height: 60px;
        border: 1px solid #e5e7eb;
    }
    
    .week-view .day-slot-info {
        padding: 8px;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Indicateurs de courts pour la vue semaine */
    .courts-status {
        display: flex;
        gap: 4px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .court-indicator {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        font-weight: 600;
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .court-indicator:hover {
        transform: scale(1.1);
    }
    
    /* Couleurs par court */
    .court-1.available {
        background-color: #3b82f6; /* Bleu clair */
    }
    
    .court-1.reserved {
        background-color: #1d4ed8; /* Bleu foncé */
    }
    
    .court-2.available {
        background-color: #10b981; /* Vert clair */
    }
    
    .court-2.reserved {
        background-color: #047857; /* Vert foncé */
    }
    
    .court-3.available {
        background-color: #f59e0b; /* Orange clair */
    }
    
    .court-3.reserved {
        background-color: #d97706; /* Orange foncé */
    }
    
    .court-number {
        font-size: 0.7rem;
        font-weight: 700;
    }
    
    /* Styles pour la légende de la vue semaine */
    .schedule-legend {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .legend-courts, .legend-status {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }
    
    .legend-title {
        font-weight: 600;
        color: #374151;
        font-size: 0.9rem;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.8rem;
        color: #6b7280;
    }
    
    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        display: inline-block;
    }
    
    /* Couleurs pour la légende */
    .legend-color.court-1-available {
        background-color: #3b82f6;
    }
    
    .legend-color.court-2-available {
        background-color: #10b981;
    }
    
    .legend-color.court-3-available {
        background-color: #f59e0b;
    }
    
    .legend-color.available {
        background-color: #10b981;
    }
    
    .legend-color.reserved {
        background-color: #ef4444;
    }
    
    /* Styles pour les cartes de statistiques */
    .stats-cards .stat-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
    border: 1px solid #e9ecef;
}

.stats-cards .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.stat-icon {
    margin-bottom: 10px;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #1e3a8a;
    margin-bottom: 5px;
}

.stat-label {
    color: #6c757d;
    font-size: 0.9rem;
    font-weight: 500;
}

/* Responsive pour les statistiques */
@media (max-width: 768px) {
    .stats-cards .stat-card {
        padding: 15px;
    }
    
    .stat-number {
        font-size: 1.5rem;
    }
    
    .stat-label {
        font-size: 0.8rem;
    }
}
</style>
{% endblock %}